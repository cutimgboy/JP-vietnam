# 股票行情数据接入任务计划

## 任务概述
修改现有的 quote 模块，正确接入 alltick.co 股票行情数据源，实现美股股票最新成交价的实时订阅和推送功能。

## 任务列表

- [x] 任务1：修改 QuoteService 的连接和认证逻辑
    - 1.1: 更新 WebSocket 连接 URL 为正确的股票 API 地址
    - 1.2: 修正 token 参数传递方式
    - 1.3: 修复连接建立逻辑，确保项目启动时自动连接

- [x] 任务2：修正订阅和取消订阅的消息格式
    - 2.1: 更新订阅消息的 cmd_id 为 22004（批量订阅最新价）
    - 2.2: 修正订阅消息的 data 结构，移除 depth_level 字段
    - 2.3: 更新取消订阅逻辑，使用正确的 cmd_id

- [x] 任务3：实现正确的心跳机制
    - 3.1: 修正心跳消息的 cmd_id 为 22000
    - 3.2: 调整心跳发送频率为每10秒一次
    - 3.3: 确保心跳消息格式符合协议要求

- [x] 任务4：创建股票 Tick 数据实体
    - 4.1: 创建 StockTickData 接口定义
    - 4.2: 在 QuoteService 中添加数据转换逻辑
    - 4.3: 实现推送数据的标准化处理

- [x] 任务5：优化数据处理和回调机制
    - 5.1: 识别并处理 cmd_id 22998 的推送数据
    - 5.2: 实现推送数据的解析和转换
    - 5.3: 添加类型化的数据回调接口

- [x] 任务6：更新默认订阅股票列表
    - 6.1: 定义美股股票代码常量
    - 6.2: 在模块初始化时自动订阅美股股票
    - 6.3: 支持配置化的股票列表

- [x] 任务7：增强错误处理和日志
    - 7.1: 完善连接错误处理
    - 7.2: 添加数据解析错误处理
    - 7.3: 优化日志输出格式

- [x] 任务8：更新配置和环境变量
    - 8.1: 确保环境变量 QUOTE_WS_TOKEN 正确配置
    - 8.2: 添加连接参数的配置化支持
    - 8.3: 更新配置文档

- [x] 任务9：验证和测试
    - 9.1: 测试连接建立和认证
    - 9.2: 验证订阅和取消订阅功能
    - 9.3: 测试实时数据接收和处理
    - 9.4: 验证重连和心跳机制

- [x] 任务10：更新文档
    - 10.1: 更新 API_DOCUMENTATION.md
    - 10.2: 更新 README.md 使用说明
    - 10.3: 添加测试示例代码
